---
title: "Portafolios de inversión"
date: "5/12/2023"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Cartera de Markowitz

Supóngamos que se tienen los siguientes activos con sus rendimientos asociadoos.

```{r datos_1a}
B=matrix(c(1/2,0,1/10,0,4,-3/10,1/10,-3/10,6), nrow=3,ncol=3)
Rend=c(1,2,3)
B
Rend
```

A la matriz de varianzas y covarianzas, se le agregan las columnas y filas auxiliares para resolver las ecuaciones de Markowitz.

```{r datos_1b}
c=c(-1,-1,-1)
d=c(-1,-2,-3)
C=cbind(B,c,d)
e=c(1,1,1,0,0)
f=c(1,2,3,0,0)
D=rbind(C,e,f)
D
```

Para encontrar la solución $A \cdot W = C$, donde $C=(0,0,0,1,r_0)$ con $r_0=2$ el rendimiento esperado del portafolio. Por lo tanto, $W= A^{-1} \cdot C$:


```{r datos_1c}
D_inv=solve(D)
round(D_inv,3)
W=D_inv %*% c(0,0,0,1,2)
W
```

Ahora, usando estos pesos, se comprobará el rendimiento y el riesgo esperado.


```{r datos_1d}
Weights=W[,1]

Weights=Weights[1:3]
```


$2=r_0=$ `r sum(Weights*Rend)`.


El riesgo del portafolio se calcula más adelante.



## Teorema de dos fondos


Considere la siguiente matriz de varianzas y covarianzas para 5 activos:

```{r A}
A=matrix(c(2.3,0.93,0.62,0.74,-0.23,
           0.93,1.4,0.22,0.56,0.26,
           0.62,0.22,1.8,0.78,-.27,
           0.74,0.56,0.78,3.4,-0.56,
           -0.23,0.26,-0.27,-0.56,2.6
           ),nrow=5, ncol=5)
A
```

Así como sus rendimientos:

```{r rend}
r_i=c(15.1,12.5,14.7,9.02,17.68)
r_i
```

El teorema de los dos fondos establece que si se tienen dos portafolios eficientes, entonces se puede construir cualquier otro portafolio eficiente como combinación de estos dos:

$F=\alpha F_1 + (1-\alpha) F_2$.

Una de las maneras de determinar esos dos portafolios, es establecer valores para $\lambda$ y $\mu$, en particular se tendrán dos casos:

- $\lambda=0$, $\mu=1$;

- $\lambda=1$, $\mu=0$.

Para que un portafolio sea eficiente, debe cumplir:

- $\sum_{i,j=1}^n \sigma_{i,j} w_i wj- \lambda \bar{r}_i - \mu=0$ para $i=1,2,...,n$;

- $\sum_{i=1}^n w_i \bar{r}_i=\bar{r}$;

- $\sum_{i=1}^n w_i=1$.

Para el caso 1, se considera $\lambda=0$, $\mu=1$ y se tiene el siguiente sistema de ecuaciones:

```{r datos_2}
A_inv=solve(A)
round(A %*% A_inv,2)
ones=rep(1,5)
V1=A_inv  %*% ones
#Se normalizan
W1=round(V1/sum(V1),3)
W1
```

Para el caso 2, se considera $\lambda=1$, $\mu=0$ y se tiene el siguiente sistema de ecuaciones:

```{r datos_2b}
r_i=c(15.1,12.5,14.7,9.02,17.68)
V2=round(A_inv  %*% r_i,3)
W2=round(V2/sum(V2),3)
W2
```

El rendimiento esperado del portafolio 1 es $\bar{r}_{F_1}=\sum_{i=1}^n w_i \cdot \bar{r}_i$ con $W_1=(w_1,...,w_n)$

```{r datos_2c}
W1
r_i=c(15.1,12.5,14.7,9.02,17.68)
as.numeric(W1)*as.numeric(r_i)
sum(as.numeric(W1)*as.numeric(r_i))
```

El rendimiento esperado del portafolio 2 es $\bar{r}_{F_1}=\sum_{i=1}^n w_i \cdot \bar{r}_i$ con $W_2=(w_1,...,w_n)$

```{r datos_2d}
W2
r_i=c(15.1,12.5,14.7,9.02,17.68)
as.numeric(W2)*as.numeric(r_i)
sum(as.numeric(W2)*as.numeric(r_i))
```


## Teorema de un fondo

Consideremos que tenemos un activo libre de riesgo con $r_f=10$. Entonces, se tiene que resolver el sistema de ecuaciones $\sum_{i=1}^n\sigma_{k,i}v_i=\bar{r}_k- r_f$, se obtiene los pesos $w_i=\dfrac{v_i}{\sum_{i=1}^n v_i}$.

```{r datos3}
rk_rf=r_i-10
V_f=A_inv %*% rk_rf
W_f=V_f/sum(V_f)


```
## Gráfica de la frontera media-varianza
$\sigma^2=\sum_{i,j=1}^n w_i w_j \sigma_{i,j}$

Sean $W_a=(a_1, a_2)$, $W_b=(b_1,b_2)$ y $\Sigma=\sigma_{i,j}$ con $i,j \in \{1,2\}$.
$W' \cdot \Sigma \cdot W$
$(a_1 \sigma_{1,1} +a_1  \sigma_{2,1},a_3 \sigma_{1,2} +a_2  \sigma_{2,2} )$
$(a_1 \sigma_{1,1} a_1 +a_1  \sigma_{2,1} a_2+a_2 \sigma_{1,2} a_1 +a_2  \sigma_{2,2} a_2 )$.

```{r datos3a, echo=T}

VarCov=A
rendimientos=r_i
r_esperado=15

Pesos=function(VarCov, rendimientos, r_esperado){
  ones=rep(1, nrow(VarCov))
  zeros=rep(0, nrow(VarCov))
  AA=cbind(VarCov, -ones, -rendimientos)
  AA=rbind(AA, c(ones,0,0), c(rendimientos,0,0))
  AA_inv=solve(AA)
  W=AA_inv %*% c(zeros, 1, r_esperado)
  W=W[1:nrow(VarCov)]
  sum(W)
  Riesgo=(t(W) %*% VarCov %*% W)^0.5
  return(Riesgo)
}

Pesos(B, Rend, 2)

Pesos(A, r_i, 15)

rend=seq(from=0.5, to=25, by=0.1)
riesgo=numeric(length(length(rend)))
for (i in 1:length(rend)){
  riesgo[i]=Pesos(A, r_i, rend[i])
}

plot(riesgo, rend, type="l")  
  


```

## Gráfica usando paqueteria IntroCompFinR

Es posible trabajar la teoría de portafolios con funciones existentes. En este caso, los parámetros de entrada son la matriz de varianzas y covarianzas, el vector de rendimientos esperados de los activos y el rendimiento del activo libre de riesgo.
```{r, warning=FALSE, message=FALSE }
library(IntroCompFinR)

cov.mat=B
er=Rend
r.free=.5

#Riesgo del portafolio 1
efficient.portfolio(er, cov.mat, 2, shorts = TRUE)

# Portafolio de varianza mínima global
gmin.port = globalMin.portfolio(er, cov.mat, shorts=T)

# Portafolio tangencial
tan.port <- tangency.portfolio(er, cov.mat, r.free, shorts=T)

# Frontera eficiente
ef <- efficient.frontier(er, cov.mat, alpha.min=-2,
                         alpha.max=1.5, nport=30, shorts = T)
attributes(ef)


plot(ef, plot.assets=TRUE, col="#0B7A75")
points(gmin.port$sd, gmin.port$er, col="#19535F", pch=16, cex=2)
points(tan.port$sd, tan.port$er, col="#7B2D26", pch=16, cex=2)
points(0, r.free, col="#19535F", pch=16, cex=2)
text(0, r.free, gmin.port$er, labels="A. L. R", pos=3)
text(gmin.port$sd, gmin.port$er, labels="PVMG", pos=2)
text(tan.port$sd, tan.port$er, labels="Tangencial", pos=3)
sr.tan = (tan.port$er - r.free)/tan.port$sd
abline(a=r.free, b=sr.tan, col="#19535F", lwd=1.5)




ef$call
ef$er
ef$sd
ef$weights

```